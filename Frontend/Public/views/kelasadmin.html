<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kelas | Yayasan Sahabat Qur'an</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/admin.css" />
</head>
<body>

  <!-- Sidebar -->
  <aside class="sidebar">
    <img src="../images/LogoYSQ.png" alt="Logo YSQ" class="logo" />
    <h2 class="yayasan">SAHABAT QUR'AN BOGOR</h2>
    <nav>
      <a href="dashboardadmin.html"><i>ğŸ </i> Dashboard</a>
      <a href="#"><i>ğŸ—“ï¸</i> Daftar Jadwal</a>
      <a href="kelasadmin.html" class="active"><i>ğŸ«</i> Daftar Kelas</a>
      <a href="#"><i>ğŸ‘¨â€ğŸ“</i> Daftar Santri</a>
      <a href="#"><i>ğŸ‘©â€ğŸ«</i> Daftar Pengajar</a>
      <a href="#"><i>ğŸ“‹</i> Riwayat Absensi</a>
      <a href="#"><i>ğŸ“˜</i> Rapor</a>
      <a href="#"><i>ğŸ“Š</i> Laporan</a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <header class="topbar">
      <h1>Kelas</h1>
      <div class="topbar-right">
        <span class="admin-text">Admin</span>
        <div class="profile-icon">ğŸ‘¤</div>
      </div>
    </header>

    <!-- Daftar Kelas -->
    <section class="kelas-section">
      <div class="kelas-header">
        <h2>Daftar Kelas</h2>
        <button class="btn-tambah" onclick="openTambahKelas()">â• Tambah Kelas</button>
      </div>

      <table id="tabelKelas">
        <thead>
          <tr>
            <th>No</th>
            <th>Nama Kelas</th>
            <th>Kapasitas</th>
            <th>Kategori</th>
            <th>Pengajar</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- Daftar Siswa -->
    <section class="siswa-section">
      <h2>Daftar Siswa</h2>
      <div class="filter-tanggal">
        <label>Tanggal:</label>
        <input type="date" id="tanggalFilter">
      </div>

      <table id="tabelSiswa">
        <thead>
          <tr>
            <th>Pilih</th>
            <th>Tanggal</th>
            <th>NIM</th>
            <th>Nama Siswa</th>
            <th>Umur</th>
            <th>Status Santri</th>
            <th>Status Kelas</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="bottom-buttons">
        <button class="btn kembali" onclick="window.location.href='dashboard-admin.html'">â¬… Kembali</button>
        <button class="btn simpan" onclick="simpanPenempatan()">Simpan</button>
      </div>
    </section>
  </main>

  <!-- Modal Tambah Kelas -->
  <div id="modalKelas" class="modal">
    <div class="modal-content">
      <h2>Tambah Kelas</h2>
      <label>Nama Kelas</label>
      <input type="text" id="namaKelas">

      <label>Pengajar</label>
      <input type="text" id="pengajar">

      <label>Kapasitas</label>
      <input type="number" id="kapasitas">

      <label>Kategori</label>
      <input type="text" id="kategori">

      <label>Waktu Awal Periode</label>
      <input type="date" id="awal">

      <label>Waktu Selesai Periode</label>
      <input type="date" id="akhir">

      <div class="modal-btns">
        <button class="btn batal" onclick="closeTambahKelas()">Batal</button>
        <button class="btn simpan" onclick="simpanKelas()">Simpan</button>
      </div>
    </div>
  </div>

  <script>
    // === DATA SEMENTARA ===
    let daftarKelas = JSON.parse(localStorage.getItem("daftarKelas")) || [
      { nama: "Iqra Awal", kapasitas: 20, kategori: "Dewasa", pengajar: "Ust. Siti" },
      { nama: "Tahfidz 1", kapasitas: 12, kategori: "Anak-anak", pengajar: "Ust. Nur" }
    ];

    let daftarSiswa = JSON.parse(localStorage.getItem("daftarSiswa")) || [
      { tanggal: "2025-10-16", nim: "2459287655", nama: "Aisyah", umur: 19, statusSantri: "Aktif", statusKelas: "Belum" },
      { tanggal: "2025-10-16", nim: "2459287656", nama: "Ziyah", umur: 18, statusSantri: "Aktif", statusKelas: "Sudah" },
      { tanggal: "2025-10-17", nim: "2459287657", nama: "Rafi", umur: 20, statusSantri: "Aktif", statusKelas: "Belum" }
    ];

    // === RENDER TABEL KELAS ===
    function renderKelas() {
      const tbody = document.querySelector("#tabelKelas tbody");
      tbody.innerHTML = daftarKelas.map((k, i) => `
        <tr>
          <td>${i + 1}</td>
          <td>${k.nama}</td>
          <td>${k.kapasitas}</td>
          <td>${k.kategori}</td>
          <td>${k.pengajar}</td>
          <td><button onclick="pilihKelas(${i})">ğŸ“‹ Daftar Siswa</button></td>
        </tr>
      `).join("");
      localStorage.setItem("daftarKelas", JSON.stringify(daftarKelas));
    }

    // === RENDER TABEL SISWA ===
    function renderSiswa(filterTanggal) {
      const tbody = document.querySelector("#tabelSiswa tbody");
      const data = filterTanggal
        ? daftarSiswa.filter(s => s.tanggal === filterTanggal)
        : daftarSiswa;

      tbody.innerHTML = data.map((s, i) => `
        <tr>
          <td><input type="checkbox" data-index="${i}"></td>
          <td>${s.tanggal}</td>
          <td>${s.nim}</td>
          <td>${s.nama}</td>
          <td>${s.umur}</td>
          <td>${s.statusSantri}</td>
          <td><span class="status ${s.statusKelas === "Sudah" ? "aktif" : "menunggu"}">${s.statusKelas}</span></td>
        </tr>
      `).join("");
    }

    document.addEventListener("DOMContentLoaded", () => {
      renderKelas();
      renderSiswa();
    });

    // === FILTER TANGGAL ===
    document.getElementById("tanggalFilter").addEventListener("change", (e) => {
      renderSiswa(e.target.value);
    });

    // === MODAL TAMBAH KELAS ===
    function openTambahKelas() {
      document.getElementById("modalKelas").style.display = "flex";
    }
    function closeTambahKelas() {
      document.getElementById("modalKelas").style.display = "none";
    }
    function simpanKelas() {
      const nama = document.getElementById("namaKelas").value;
      const pengajar = document.getElementById("pengajar").value;
      const kapasitas = parseInt(document.getElementById("kapasitas").value);
      const kategori = document.getElementById("kategori").value;

      daftarKelas.push({ nama, kapasitas, kategori, pengajar });
      localStorage.setItem("daftarKelas", JSON.stringify(daftarKelas));
      renderKelas();
      closeTambahKelas();
      alert("Kelas baru berhasil ditambahkan!");
    }

  // === Tombol "Tambah Kelas" ke kelasadmin.html ===
  document.getElementById("btnTambahKelas").addEventListener("click", () => {
    // Simpan flag ke localStorage
    localStorage.setItem("bukaModalKelas", "true");
    // Redirect ke halaman kelas admin
    window.location.href = "kelasadmin.html";
  });

    // === PILIH KELAS (Masuk Daftar Siswa) ===
    let kelasDipilih = null;
    function pilihKelas(index) {
      kelasDipilih = index;
      alert(`Anda sedang menempatkan santri ke kelas: ${daftarKelas[index].nama}`);
    }

    // === SIMPAN PENEMPATAN SANTRI ===
    function simpanKelas() {
  const nama = document.getElementById("namaKelas").value;
  const pengajar = document.getElementById("pengajar").value;
  const kapasitas = parseInt(document.getElementById("kapasitas").value);
  const kategori = document.getElementById("kategori").value;

  if (!nama || !pengajar || !kapasitas || !kategori) {
    alert("Mohon lengkapi semua data kelas!");
    return;
  }

  daftarKelas.push({ nama, kapasitas, kategori, pengajar });
  localStorage.setItem("daftarKelas", JSON.stringify(daftarKelas));
  renderKelas();
  closeTambahKelas();
  alert("âœ… Kelas baru berhasil ditambahkan!");
}
    // === CEK URL PARAMETER UNTUK OTOMATIS BUKA MODAL TAMBAH KELAS ===
window.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);
  if (params.get('addClass') === 'true') {
    document.getElementById("modalKelas").style.display = "flex";
  }
});
  </script>
</body>
</html>
